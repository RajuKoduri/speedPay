<div>
    <h3>Mass Bonus list </h3>
</div>

<div class="dropdown fd">
    <button (click)="fillermenu()" class="fillterbtn font_14">Filters
        <i *ngIf="!FillterMenu" class="fa fa-chevron-down IcArrow" title="open"
            style="font-size:14px;  transition:all 0.5s ;"></i>
        <i *ngIf="FillterMenu" class="fa fa-chevron-up IcArrow" title="close"
            style="font-size:14px; transition:all 0.5s"></i>
    </button>

    <button class="fillterbtn m_l_5" style=" float: right;" (click)="exportexcel()"> Export Excel</button>
    <button class="fillterbtn m_l_5 btn_sub12" style=" float: right;" (click)="exportCsv()"> Export CSV</button>
</div>

<div class="fd filterDiv" *ngIf="FillterMenu">
    <form [formGroup]="filterForm">
        <div class=" p_25">
            <div class="container">
                <div class="row">
                    <div class="col-12 col-lg-6 col-xl-4">
                        <div class="div_flex p_5_10">
                            <label>Email Mask</label>
                            <input type="text" placeholder="(none)" formControlName="emailMask"
                                appMaxLengthValidation />
                        </div>

                        <div class="div_flex p_5_10">
                            <label>Birthday Day</label>
                            <input class="Birthdayinputs" type="text" placeholder="(none)" appMaxLengthValidation
                                formControlName="birthDayOfMonthFrom" />
                            <input class="Birthdayinputs" type="text" placeholder="(none)" appMaxLengthValidation
                                formControlName="birthDayOfMonthTo" />
                        </div>
                        <div class="div_flex p_5_10">
                            <label>Birthday Month</label>
                            <div class="multi_dropdown">
                                <ng-multiselect-dropdown [settings]="bdyMonthDropdownSettings"
                                    [data]="BirthdatMonthsList" [(ngModel)]="selectedBdyMonth"
                                    formControlName="birthMonths"></ng-multiselect-dropdown>
                            </div>
                        </div>
                        <div class="div_flex p_5_10">
                            <label>Not logged in for</label>
                            <input class="Birthdayinputs" type="text" placeholder="(none)"
                                formControlName="notLoggedInForLow" appMaxLengthValidation />
                            <input class="Birthdayinputs" type="text" placeholder="(none)"
                                formControlName="notLoggedInForHigh" appMaxLengthValidation />

                        </div>
                        <div class="div_flex p_5_10">
                            <label> Have Opened Account Start</label>
                            <input class="inp_agent_time Birthdayinputs" type="date" [max]="endDate"
                                formControlName="startDate" [ngModel]="startDate" (ngModelChange)="startDate = $event"
                                (change)="showDate($event)" />
                            <input class="inp_agent_time Birthdayinputs mobile_view" type="time"
                                formControlName="startTime" step="1" [ngModel]="startTime"
                                (ngModelChange)="startTime = $event" (change)="timechange($event)" [max]="endTime" />
                        </div>
                        <div class="div_flex p_5_10">
                            <label>Have Opened Account End</label>
                            <input class="inp_agent_time Birthdayinputs" type="date" [max]="todaydate"
                                formControlName="endDate" [ngModel]="endDate" (ngModelChange)="endDate = $event"
                                (change)="showDate($event)" />
                            <input class="inp_agent_time  Birthdayinputs mobile_view" type="time"
                                formControlName="endTime" step="1" [ngModel]="endTime"
                                (ngModelChange)="endTime = $event" (change)="timechange($event)" />
                        </div>
                        <div class="red_col" *ngIf="steddate">
                            Start date should be below or equal to end date
                        </div>
                        <div class="red_col" *ngIf="timeerror">
                            Start time should be below or equal to end time
                        </div>
                    </div>

                    <div class="col-12 col-lg-6 col-xl-4">

                        <div class="div_flex p_5_10">
                            <label>Have Deposit</label>
                            <div class="multi_dropdown">
                                <ng-multiselect-dropdown [settings]="haveDepositDropdownSettings"
                                    [data]="MailingDepositList" [(ngModel)]="selectedMailingDeposit"
                                    formControlName="deposit"></ng-multiselect-dropdown>
                            </div>
                        </div>
                        <div class="div_flex p_5_10">
                            <label>Player Level</label>
                            <div class="multi_dropdown">
                                <ng-multiselect-dropdown [settings]="playerLevelDropdownSettings"
                                    [data]="getPlayerLevelsNamesList.compPointsLevels"
                                    [(ngModel)]="selectedPlayerLevels"
                                    formControlName="levelGuids"></ng-multiselect-dropdown>
                            </div>
                        </div>
                        <div class="div_flex p_5_10">
                            <label>User Status</label>
                            <div class="multi_dropdown">
                                <ng-multiselect-dropdown [settings]="playerStatusDropdownSettings"
                                    [data]="palyerstatusList" [(ngModel)]="selectedPlayerStatus"
                                    formControlName="userStatus"></ng-multiselect-dropdown>
                            </div>
                        </div>

                        <div class="div_flex p_5_10">
                            <label>Number of Withdrawals for Period</label>
                            <input class="Birthdayinputs" type="text" placeholder="(none)"
                                formControlName="numberOfWithdrawsLow" appMaxLengthValidation />
                            <input class="Birthdayinputs" type="text" placeholder="(none)"
                                formControlName="numberOfWithdrawsHigh" appMaxLengthValidation />
                        </div>

                        <div class="div_flex p_5_10">
                            <label>Game Rounds</label>
                            <input class="Birthdayinputs" type="text" placeholder="(none)"
                                formControlName="gameRoundsLow" appMaxLengthValidation />
                            <input class="Birthdayinputs" type="text" placeholder="(none)"
                                formControlName="gameRoundsHigh" appMaxLengthValidation />
                        </div>

                        <div class="div_flex p_5_10">
                            <label>Number of Deposite for Period</label>
                            <input class="Birthdayinputs" type="text" placeholder="(none)"
                                formControlName="numberOfDepositsLow" appMaxLengthValidation />
                            <input class="Birthdayinputs" type="text" placeholder="(none)"
                                formControlName="numberOfDepositsHigh" appMaxLengthValidation />
                        </div>

                    </div>

                    <div class="col-12 col-lg-6 col-xl-4">

                        <div class="div_flex p_5_10">
                            <label> Filter Time Period Start</label>
                            <input class="inp_agent_time Birthdayinputs" type="date" [max]="endDate"
                                formControlName="filterStartDate" [ngModel]="filterStartDate"
                                (ngModelChange)="startDate = $event" (change)="showDate($event)" />
                            <input class="inp_agent_time Birthdayinputs mobile_view" type="time"
                                formControlName="FilterStartTime" step="1" [ngModel]="FilterStartTime"
                                (ngModelChange)="startTime = $event" (change)="timechange($event)" [max]="endTime" />
                        </div>
                        <div class="div_flex p_5_10">
                            <label>Filter Time Period End</label>
                            <input class="inp_agent_time Birthdayinputs" type="date" [max]="todaydate"
                                formControlName="filterEndDate" [ngModel]="filterEndDate"
                                (ngModelChange)="endDate = $event" (change)="showDate($event)" />
                            <input class="inp_agent_time  Birthdayinputs mobile_view" type="time"
                                formControlName="filterEndTime" step="1" [ngModel]="filterEndTime"
                                (ngModelChange)="endTime = $event" (change)="timechange($event)" />
                        </div>
                        <div class="red_col" *ngIf="steddate">
                            Start date should be below or equal to end date
                        </div>
                        <div class="red_col" *ngIf="timeerror">
                            Start time should be below or equal to end time
                        </div>

                        <div class="div_flex p_5_10">
                            <label>Number of Deposite since last Bonus</label>
                            <input class="Birthdayinputs" type="text" placeholder="(none)"
                                formControlName="numberOfDepositsSinceLastBonusLow" appMaxLengthValidation />
                            <input class="Birthdayinputs" type="text" placeholder="(none)"
                                formControlName="numberOfDepositsSinceLastBonusHigh" appMaxLengthValidation />
                        </div>
                        <div class="div_flex p_5_10">
                            <label>First Record</label>
                            <input type="text" formControlName="firstRecord" />
                        </div>
                        <div class="div_flex p_5_10">
                            <label>Page Size</label>
                            <input type="text" formControlName="maxCountRecord" />
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<div class="fd">
    <button class="fillterbtn font_14" style=" float: right;" (click)="filterPopup()">Submit</button>
    <div class="df m_3">
        <div style="margin-right:20px;" *ngIf="bonusMailingList">Rows On the Page: {{rowsOnthePage}}</div>
        <div> Result Count: {{ResultCount}} <b *ngIf="resultcount">To get data set and apply
                the filters</b></div>
    </div>
</div>


<div class='fd table_2'>
    <div *ngIf="loader">
        <div class="loaderWraper">
            <div class="loader"></div>
        </div>
    </div>
    <table class="tablCode" id="excel-table">
        <thead>
            <tr>
                <th>Section</th>
                <th>Player Email</th>
                <th>Registation Date</th>
                <th>Full Name</th>
                <th>Actions</th>
                <th>Preferred Balance</th>
                <th>Not Logged in Days</th>
                <th>Number of Deposits</th>
                <th>Number of Withdrawals</th>
                <th>Deposit Since Last Bonus</th>
                <th>Login</th>
            </tr>
        </thead>

        <!-- <tbody *ngIf="bonusMailingList">
            <tr *ngFor="let list of bonusMailingList; let i = index ">
                <td>
                    <input type="checkbox" [(ngModel)]="list.selection" (change)="checkBoxChange(list)">
                </td>
                <td>{{list.player.account}}</td>
                <td>{{list.player.network}}</td>
                <td></td>
                <td>{{list.registrationDate.slice(0,10)}}</td>
                <td>
                    <div class="fd">
                        <div class="trigger">
                            <a><i class="fa fa-reorder" style="color: #fff;"(click)="showmanu(i,list.guid)"></i> </a>
                           
                            <div *ngIf="popupArrow" class="fd">
                                <div *ngIf="SeletedIconIndex == i" class="popup1 btnGrp">
                                    <button (click)="changePermissionGroupPopup(list)">Change Permission Group</button>
                                    <button (click)="sendMailforPlayer()">Send mail</button>
                                    <button (click)="OnActions(list,'checkSelection')">Check selection</button>
                                    <button (click)="OnActions(list,'uncheckSelection')">Uncheck selection</button>
                                    <button (click)="OnActions(list,'invertSelection')">Invert selection</button>
                                    <button (click)="OnActions(list,'checkPage')">Check page</button>
                                    <button (click)="OnActions(list,'uncheckPage')">Uncheck page</button>
                                    <button (click)="OnActions(list,'uncheckAll')">Uncheck all</button>
                                    <button (click)="OnActions(list,'checkAll')">Check all</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
                <td>{{list.player.fullName}}</td>
                <td class="text-end">{{getWalletSymbol(list.balance.wallet)}} {{list.balance.value}}</td>
                <td class="text-end">{{list.notLoggedInDays}}</td>
                <td class="text-end">{{list.numberOfDepositsSinceLastBonus}}</td>
            </tr>
        </tbody>
        <tfoot *ngIf="bonusMailingList && bonusMailingList.length > 0">
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td class="text-end">SUM = 
                    <span *ngFor="let key of keys(totalSum)">{{totalSum[key]}}</span>
                </td>
                <td></td>
                <td></td>
            </tr>
        </tfoot> -->
    </table>
</div>

<!-- pagination-controls -->
<div class="fd" *ngIf="bonusMailingList">
    <div class="pagecount">
        <button class="Pagebtns" [disabled]="PageCount==1 || bonusMailingList==null" (click)="fastbackforward()">
            <i class="fa fa-step-backward" style="font-size:20px"></i>
        </button>
        <button class="Pagebtns" [disabled]="PageCount==1 ||bonusMailingList==null" (click)="prev()">
            <i class="fa fa-caret-left" style="font-size:20px"></i>
        </button>
        <div class="PageCountNoDiv">
            <div class="" *ngIf="bonusMailingList">{{PageCount}}</div>
        </div>
        <button class="Pagebtns " [disabled]="bonusMailingList==null || pagecontrolbtn" (click)="next()">
            <i class="fa fa-caret-right" style="font-size:20px"></i>
        </button>
        <button class="Pagebtns" [disabled]="bonusMailingList==null || pagecontrolbtn" (click)="fastforward()">
            <i class="fa fa-step-forward" style="font-size:20px"></i></button>
    </div>
</div>

<!-- ################################# Filter Popup ########################################## -->

<div class="black_cover" *ngIf='isFilterPopup'>
    <div class="popup_1 pop_sm text-black" *ngIf='isFilterPopup'>
        <div class="PopupHead">
            <h5 class="text-center">Filter Applying</h5>
            <span class="closetop" (click)="filterPopup()"> <img src="assets/icons/closePop.svg">
            </span>
        </div>
        <div class="soon font_13 fd p_lr_15">
            <div class="row fd p-3 d-flex text-center">
                Would you like to send Email notifications right now or view mailing list ?
            </div>
        </div>
        <div class="bottomFix">
            <button class="btn_grade_1" (click)="onView()"> View </button>
            <button class="btn_grade_2" (click)="onSend()"> send </button>
            <button class="btn_grade_3" (click)="filterPopup()"> Cancel </button>
        </div>
    </div>
</div>



<!-- ####################################### send player mail popup ####################################  -->

<div class="black_cover" *ngIf='isMailSend'>
    <div class="popup_1 text-black " *ngIf='isMailSend'>
            <div class="PopupHead">
                <h5 class="text-center">Deposit Bonus Settings</h5>
                <span class="closetop" (click)="emailTempPopup('mailSend')"> <img src="assets/icons/closePop.svg">
                </span>
            </div>
            <div class='fd table_0 mx-2'>
                <div *ngIf="loader">
                    <div class="loaderWraper">
                        <div class="loader"></div>
                    </div>
                </div>
                <table class="tablCode" id="excel-table">
                    <thead>
                        <tr>
                            <th>Payment System</th>
                            <th>Currency</th>
                            <th>Indude</th>
                            <th>First Deposit:Min Amount</th>
                            <th>First Deposit:Bonus %</th>
                            <th>First Deposit: Flat Bonus</th>
                            <th>First Deposit: Max Bonus Amount, Cash</th>
                            <th>Next Deposit: Min Deposite Amount</th>
                            <th>Next Deposit:Bonus %</th>
                            <th>Next Deposit: Flat Bonus</th>
                            <th>Next Deposit: Max Bonus Amount, Cash</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let list of getCurrencyData">
                            <td>{{list.paymentSysName}}</td>
                            <td>{{list.currencyName}}</td>
                            <td><input type="checkbox" [(ngModel)]="list.selected"></td>
                            <td><input type="number" class="form-control"  appMaxLengthValidation [(ngModel)]="list.firstMinDeposit" ></td>
                            <td><input type="number" class="form-control"  appMaxLengthValidation [(ngModel)]="list.firstPercent" [maxNumber]=6 ></td>
                            <td><input type="number" class="form-control"  appMaxLengthValidation [(ngModel)]="list.firstFixedBonus" ></td>
                            <td><input type="number" class="form-control"  appMaxLengthValidation [(ngModel)]="list.firstMaxBonus" ></td>
                            <td><input type="number" class="form-control"  appMaxLengthValidation [(ngModel)]="list.nextMinDeposit" ></td>
                            <td><input type="number" class="form-control"  appMaxLengthValidation [(ngModel)]="list.nextPercent" [maxNumber]=6></td>
                            <td><input type="number" class="form-control"  appMaxLengthValidation [(ngModel)]="list.nextFixedBonus" ></td>
                            <td><input type="number" class="form-control"  appMaxLengthValidation [(ngModel)]="list.nextMaxBonus" ></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        <div class="soon font_13 fd p_lr_15 border rounded mt-2">
            <div class="fd p-2 row">
                <div class="col-4">
                    <label>Bonus Adjustment:</label>
                </div>
                <div class="col-4">
                    <input type="number" class="form-control" [disabled]="!adjustmentIncluded" [(ngModel)]="adjustmentValue">
                </div>
                <div class="col-4 df">
                    <input type="checkbox" class="me-1" id="include" [(ngModel)]="adjustmentIncluded">
                    <label for="include">Include</label>
                </div>
            </div>
            <div class="fd p-2 row">
               <div class="col-4">
                <label> E-mail template:</label>
               </div>
                <div class="col-8">
                    <select class="form-select my-2" [(ngModel)]="selectedTempforMail">
                        <option [ngValue]="list.guid" *ngFor="let list of templateList">{{list.name}}</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="bottomFix">
            <button class="btn_grade_1" (click)="sendMail()"> OK </button>
            <button class="btn_grade_2" (click)="emailTempPopup('mailSend')"> Cancel </button>
        </div>

    </div>
</div>


<!-- ####################################### Email Template Error popup ####################################  -->

<div class="black_cover" *ngIf='isEmailTemp'>
    <div class="popup_1 pop_sm text-black" *ngIf='isEmailTemp'>
        <div class="PopupHead">
            <h5 class="text-center">Error</h5>
            <span class="closetop" (click)="emailTempPopup('emailTemp')"> <img src="assets/icons/closePop.svg">
            </span>
        </div>
        <div class="soon font_13 fd p_lr_15">
            <div class="row fd p-3 d-flex text-center " *ngIf="!submitted">
                There are no available e-mail templates
            </div>
            <div class="row fd p-3 d-flex text-center " *ngIf="submitted">
                Please tick at least one of the options in the Deposit Bonus Settings table, or choose the appropriate Bonus Adjustment option.
            </div>
        </div>
        <div class="bottomFix">
            <button class="btn_grade_3" (click)="emailTempPopup('emailTemp')"> OK </button>
        </div>
    </div>
</div>
